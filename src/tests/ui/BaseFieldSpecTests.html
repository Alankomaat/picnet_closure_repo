<!doctyp  e html>
<html>
  <head></head>
  <body>
    <script src="http://localhost/shared/closure-library/closure/goog/base.js"></script>
    <script src="../../deps.js"></script>
    <script>
goog.require('goog.testing.jsunit');

goog.require('pn.ui.BaseFieldSpec');

// TODO: This should be replaced with a nice MockSchema object
var pn = pn || {};
pn.app = pn.app || {};
pn.app.ctx = pn.app.ctx || {};
pn.app.ctx.schema = {
  getEntitySchema: function(type) {
    return {
      getField: function(field) {
        return {
          type: type === 'Child' ?
            (field === 'ParentID' ? 'Parent' :
            field === 'OtherParentID' ? 'OtherParent' : '') :
            type === 'Parent' ? 
              (field === 'GrandParentID' ? 'GrandParent' : '') :
            type === 'EntityType' ?
              (field === 'ChildID' ? 'Child' : 'Parent') : ''
        };
      }
    };
  }
};
var extendby = {
  entitySpec: {
    type:'EntityType'
  }
};

var testExtendsOnSimpleProp = function() {
  var fs = new pn.ui.BaseFieldSpec('NameField', {});
  fs.extend(extendby);

  assertEquals('NameField', fs.id);
  assertEquals('Name Field', fs.name);
  assertEquals('NameField', fs.dataProperty);
  assertEquals('', fs.displayPath); // Display Path only inferred for relations
  assertArrayEquals([], fs.additionalCacheTypes);
};

var testExtendsOnSingleStepParentRelationship = function() {
  var fs = new pn.ui.BaseFieldSpec('ParentID', {});
  fs.extend(extendby);

  assertEquals('ParentID', fs.id);
  assertEquals('Parent', fs.name);
  assertEquals('ParentID', fs.dataProperty);
  assertEquals('ParentID.ParentName', fs.displayPath);
  assertArrayEquals([], fs.additionalCacheTypes);
};

var testExtendsOnSingleStepChildRelationship = function() {
  var fs = new pn.ui.BaseFieldSpec('ChildEntities', {});
  fs.extend(extendby);

  assertEquals('ChildEntities', fs.id);
  assertEquals('Childs', fs.name);
  assertEquals('ChildEntities', fs.dataProperty);
  assertEquals('ChildEntities.ChildName', fs.displayPath);
  assertArrayEquals([], fs.additionalCacheTypes);
};

var testExtendsOnMultiStepParentRelationship = function() {
  var fs = new pn.ui.BaseFieldSpec('ParentID.GrandParentID', {});
  fs.extend(extendby);

  assertEquals('ParentID.GrandParentID', fs.id);
  assertEquals('Grand Parent', fs.name);
  assertEquals('ParentID', fs.dataProperty);
  assertEquals('ParentID.GrandParentID.GrandParentName', fs.displayPath);
  assertArrayEquals([], fs.additionalCacheTypes);
};

var testExtendsOnMultiStepChildRelationship = function() {
  var fs = new pn.ui.BaseFieldSpec('ChildEntities.OtherParentID', {});
  fs.extend(extendby);

  assertEquals('ChildEntities.OtherParentID', fs.id);
  assertEquals('Other Parent', fs.name);
  assertEquals('ChildEntities', fs.dataProperty);
  assertEquals('ChildEntities.OtherParentID.OtherParentName', fs.displayPath);
  assertArrayEquals([], fs.additionalCacheTypes);
};
    </script>    
  </body>
</html>

