<!doctype html>
<html>
  <head></head>
  <body>
    <script src="http://localhost/shared/closure-library/closure/goog/base.js"></script>
    <script src="../deps.js"></script>
    <script>
goog.require('goog.testing.jsunit');
goog.require('pn.seq.Seq');

var testNullInnerThrowsError = function() {    
  try {
    pn.seq([5, 3, 7]).groupJoin(null, 
                         function(o) { return o; }, 
                         function(i) { return i.length; }, 
                         function(o, i) { return o + ':' + i; });                           
    assertFail('inner should not be null');
  } catch (ex) {};
};

var testNullOuterSelectThrowsError = function() {  
  var inner = pn.seq(["bee", "giraffe", "tiger", "badger", "ox", "cat", "dog"]); 

  try {
    pn.seq([5, 3, 7]).groupJoin(inner, 
                         null, 
                         function(i) { return i.length; }, 
                         function(o, i) { return o + ':' + i; });                           
    assertFail('outerSelector should not be null');
  } catch (ex) {};
};

var testNullInnerSelectThrowsError = function() {  
  var inner = pn.seq(["bee", "giraffe", "tiger", "badger", "ox", "cat", "dog"]); 

  try {
    pn.seq([5, 3, 7]).groupJoin(inner, 
                         function(o) { return o; }, 
                         null, 
                         function(o, i) { return o + ':' + i; });                           
    assertFail('innerSelector should not be null');
  } catch (ex) {};
};

var testNullResultsSelectorThrowsError = function() {  
  var inner = pn.seq(["bee", "giraffe", "tiger", "badger", "ox", "cat", "dog"]); 

  try {
    pn.seq([5, 3, 7]).groupJoin(inner, 
                         function(o) { return o; }, 
                         function(i) { return i.length; }, 
                         null);                           
    assertFail('resultsSelector should not be null');
  } catch (ex) {};
};

var testSimpleGroupJoin = function() 
{ 
  var outer = pn.seq(["first", "second", "third"]); 
  var inner = pn.seq(["essence", "offer", "eating", "psalm"]); 

  var query = outer.groupJoin(inner, 
    function(o) { return o[0]; }, 
    function(i) { return i[1]; }, 
    function(o, i) { 
      console.log('o : ' + o + ' i : ' + i);
      return o + ':' + i.toArray().join(';'); });                         
                         
  assertArrayEquals(["first:offer", "second:essence;psalm", "third:"], query.toArray()); 
};

var testMultipleGroupJoins = function() 
{ 
  var outer = pn.seq(["first", "second", "third"]); 
  var inner = pn.seq(["essence", "offer", "eating", "psalm"]); 

  var query = outer.groupJoin(inner, 
    function(o) { return o[0]; }, 
    function(i) { return i[1]; }, 
    function(o, i) { 
      console.log('o : ' + o + ' i : ' + i);
      return o + ':' + i.toArray().join(';'); });                         
                         
  assertArrayEquals(["first:offer", "second:essence;psalm", "third:"], query.toArray()); 
  query = outer.groupJoin(inner, 
    function(o) { return o[0]; }, 
    function(i) { return i[1]; }, 
    function(o, i) { 
      console.log('o : ' + o + ' i : ' + i);
      return o + ':' + i.toArray().join(';'); });                         
                         
  assertArrayEquals(["first:offer", "second:essence;psalm", "third:"], query.toArray()); 
};

    </script>    
  </body>
</html>