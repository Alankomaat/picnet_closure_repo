<!doctype html>
<html>
  <head></head>   
  <body>    
    <script src="http://localhost/shared/closure-library/closure/goog/base.js"></script>
    <script src="../../deps.js"></script>
    <script>
goog.require('goog.testing.jsunit');

goog.require('pn');
goog.require('pn.alg.sort');
goog.require('pn.alg.heapsort');
    </script>
    <script>
var test_selection = function() { assertAlgorithm(pn.alg.sort.selection); };

var test_insertion = function() { assertAlgorithm(pn.alg.sort.insertion); };

var test_shell = function() { assertAlgorithm(pn.alg.sort.shell); };

var test_merge = function() { assertAlgorithm(pn.alg.sort.merge); };

var test_quick = function() { assertAlgorithm(pn.alg.sort.quick); };

var test_heap = function() { assertAlgorithm(pn.alg.heapsort.sort); };

// Actual Perf: N^2 / 2
var test_selection_performance_is_quadratic = function() { assertAlgorithmIsQuadratic(pn.alg.sort.selection); };

// Actual Perf: N^2 / 4
var test_insertion_performance_is_quadratic = function() { assertAlgorithmIsQuadratic(pn.alg.sort.insertion); };

// Actual Perf: N^1.5
var test_shell_performance_is_quadratic = function() { assertAlgorithmIsQuadratic(pn.alg.sort.insertion); };

// Actual Perf: N log N
var test_merge_performance_is_linearithmic = function() { 
  // Should have a better test for linearithmic, perhaps remove these 
  // perhformance tests, they are not adding much
  assertAlgorithmIsLinearithmic(pn.alg.sort.merge); 
};

// Actual Perf: N log N
var test_quick_performance_is_linearithmic = function() { 
  // Should have a better test for linearithmic, perhaps remove these 
  // perhformance tests, they are not adding much
  assertAlgorithmIsLinearithmic(pn.alg.sort.quick); 
};

var assertAlgorithmIsQuadratic = function(alg) {
  assertAlgorithmPerformance(alg, function(tookSmall, tookLarge, multiplier) {
    assertTrue(tookLarge > tookSmall * multiplier);    
  });
};

var assertAlgorithmIsLinearithmic = function(alg) {
  assertAlgorithmPerformance(alg, function(tookSmall, tookLarge, multiplier) {
    assertTrue(tookLarge > tookSmall * 2);    
  });
};

var assertAlgorithmPerformance = function(alg, testCallback) {
  var base = 100;
  var mult = 20;
  var took200 = timeSort(createArray(base), alg);
  var took20k = timeSort(createArray(base * mult), alg);
  testCallback(took200, took20k, mult);    
};

var assertAlgorithm = function(alg) {
  var arr = createArray(100);
  alg(arr);
  var exp = goog.array.clone(arr);
  
  exp.sort();
  assertArrayEquals(exp, arr);
};

var timeSort = function(arr, alg) {
  var start = goog.now();
  alg(arr);
  return goog.now() - start;
};

var createArray = function(len) {
  var arr = new Array(len);
  for (var i = 0; i < len; i++) { arr[i] = Math.random(); }
  return arr;
};
    </script>    
  </body>
</html>