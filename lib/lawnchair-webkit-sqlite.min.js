Lawnchair.adapter("webkit-sqlite",function(){var f=function(a,d){console.log("error in sqlite adaptor!",a,d)};Function.prototype.bind||(Function.prototype.bind=function(a){var d=[].slice,b=d.call(arguments,1),c=this,e=function(){},h=function(){return c.apply(this instanceof e?this:a||{},b.concat(d.call(arguments)))};e.prototype=c.prototype;h.prototype=new e;return h});return{valid:function(){return!!window.openDatabase},init:function(a,d){var b=this,c=b.fn(b.name,d),e="CREATE TABLE IF NOT EXISTS "+
this.name+" (id NVARCHAR(32) UNIQUE PRIMARY KEY, value TEXT, timestamp REAL)",h=function(){return c.call(b,b)};this.db=openDatabase(this.name,"1.0.0",this.name,65536);this.db.transaction(function(a){a.executeSql(e,[],h,f)})},keys:function(a){var d=this.lambda(a),b=this,c="SELECT id FROM "+this.name+" ORDER BY timestamp DESC";this.db.transaction(function(a){a.executeSql(c,[],function(a,c){if(0==c.rows.length)d.call(b,[]);else{for(var e=[],g=0,m=c.rows.length;g<m;g++)e.push(c.rows.item(g).id);d.call(b,
e)}},f)});return this},save:function(a,d){var b=this,c=a.key||b.uuid(),e="INSERT INTO "+this.name+" (value, timestamp, id) VALUES (?,?,?)",h="UPDATE "+this.name+" SET value=?, timestamp=? WHERE id=?",l=function(){d&&(a.key=c,b.lambda(d).call(b,a))},k=[new Date,c];b.exists(a.key,function(c){b.db.transaction(function(b){c?(delete a.key,k.unshift(JSON.stringify(a)),b.executeSql(h,k,l,f)):(k.unshift(JSON.stringify(a)),b.executeSql(e,k,l,f))})});return this},batch:function(a,d){for(var b=[],c=!1,e=this,
h=function(d){b.push(d);c=b.length===a.length},l=setInterval(function(){c&&(d&&e.lambda(d).call(e,b),clearInterval(l))},200),k=0,g=a.length;k<g;k++)this.save(a[k],h);return this},get:function(a,d){var b=this,c="",c=this.isArray(a)?"SELECT id, value FROM "+this.name+" WHERE id IN ('"+a.join("','")+"')":"SELECT id, value FROM "+this.name+" WHERE id = '"+a+"'",e=function(c,e){var k=null,g=[];if(e.rows.length)for(var f=0,n=e.rows.length;f<n;f++)k=JSON.parse(e.rows.item(f).value),k.key=e.rows.item(f).id,
g.push(k);b.isArray(a)||(g=g.length?g[0]:null);d&&b.lambda(d).call(b,g)};this.db.transaction(function(a){a.executeSql(c,[],e,f)});return this},exists:function(a,d){var b="SELECT * FROM "+this.name+" WHERE id = ?",c=this,e=function(a,b){d&&c.fn("exists",d).call(c,0<b.rows.length)};this.db.transaction(function(c){c.executeSql(b,[a],e,f)});return this},all:function(a){var d=this,b="SELECT * FROM "+this.name,c=[],e=this.fn(this.name,a)||void 0,h=function(a,b){if(0!=b.rows.length)for(var g=0,f=b.rows.length;g<
f;g++){var h=JSON.parse(b.rows.item(g).value);h.key=b.rows.item(g).id;c.push(h)}e&&e.call(d,c)};this.db.transaction(function(a){a.executeSql(b,[],h,f)});return this},remove:function(a,d){var b=this,c="string"===typeof a?a:a.key,e="DELETE FROM "+this.name+" WHERE id = ?",h=function(){d&&b.lambda(d).call(b)};this.db.transaction(function(a){a.executeSql(e,[c],h,f)});return this},nuke:function(a){var d="DELETE FROM "+this.name,b=this,c=a?function(){b.lambda(a).call(b)}:function(){};this.db.transaction(function(a){a.executeSql(d,
[],c,f)});return this}}}());